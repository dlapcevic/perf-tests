name: load
automanagednamespaces: 0
namespace:
  number: 2
  prefix: test-249mat
  deletestalenamespaces: false
  deleteautomanagednamespaces: true
  enableexistingnamespaces: false
steps:
- phases: []
  measurements:
  - method: APIResponsivenessPrometheus
    params:
      action: start
      allowedSlowCalls: 0
      customThresholds: ""
      enableViolations: false
    identifier: APIResponsivenessPrometheus
    instances: []
  - method: APIResponsivenessPrometheus
    params:
      action: start
      allowedSlowCalls: 0
      customThresholds: ""
      enableViolations: true
      summaryName: APIResponsivenessPrometheus_simple
      useSimpleLatencyQuery: true
    identifier: APIResponsivenessPrometheusSimple
    instances: []
  - method: PodStartupLatency
    params:
      action: start
      labelSelector: group = load
      threshold: 1h
    identifier: CreatePhasePodStartupLatency
    instances: []
  - method: NetworkProgrammingLatency
    params:
      action: start
    identifier: NetworkProgrammingLatency
    instances: []
  - method: TestMetrics
    params:
      action: start
      clusterOOMsIgnoredProcesses: ""
      clusterOOMsTrackerEnabled: false
      enableRestartCountCheck: false
      restartCountThresholdOverrides: ""
      systemPodMetricsEnabled: false
    identifier: TestMetrics
    instances: []
  module:
    path: ""
    params: {}
  name: starting measurements
- phases: []
  measurements:
  - method: GenericPrometheusQuery
    params:
      action: start
      metricName: Network Policy Enforcement Latency
      metricVersion: v1
      queries:
      - name: PolicyCreation - TargetCount
        query: sum(policy_enforcement_latency_policy_creation_seconds_count)#[%v]
      - name: PolicyCreation - Bucket 5s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="5"})#[%v]
      - name: PolicyCreation - Bucket 10s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="10"})#[%v]
      - name: PolicyCreation - Bucket 60s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="60"})#[%v]
      - name: PolicyCreation - Perc50
        query: histogram_quantile(0.5, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc90
        query: histogram_quantile(0.9, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc95
        query: histogram_quantile(0.95, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc99
        query: histogram_quantile(0.99, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PodCreation - TargetCount
        query: sum(policy_enforcement_latency_pod_creation_seconds_count)
      - name: PodCreation - Bucket 1s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="1"})
      - name: PodCreation - Bucket 5s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="5"})
      - name: PodCreation - Bucket 10s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="10"})
      - name: PodCreation - Bucket 60s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="60"})
      - name: PodCreation - Bucket 600s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="600"})
      - name: PodCreation - Perc50
        query: histogram_quantile(0.5, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc90
        query: histogram_quantile(0.9, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc95
        query: histogram_quantile(0.95, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc99
        query: histogram_quantile(0.99, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - TargetCount
        query: sum(pod_ip_address_assigned_latency_seconds_count)#[%v:]
      - name: PodIpAssignedLatency - Perc50
        query: histogram_quantile(0.50, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc90
        query: histogram_quantile(0.90, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc95
        query: histogram_quantile(0.95, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc99
        query: histogram_quantile(0.99, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      unit: s
    identifier: NetworkPolicyEnforcementLatency
    instances: []
  - method: GenericPrometheusQuery
    params:
      action: start
      metricName: Network Policy Performance
      metricVersion: v1
      queries:
      - name: Number of policies currently loaded
        query: avg(cilium_policy)
      - name: Policy regeneration time - Perc50
        query: histogram_quantile(0.50, sum(cilium_policy_regeneration_time_stats_seconds_bucket{scope="total"})
          by (le))
      - name: Policy regeneration time - Perc99
        query: histogram_quantile(0.99, sum(cilium_policy_regeneration_time_stats_seconds_bucket{scope="total"})
          by (le))
      - name: Number of times a policy import has failed
        query: sum(cilium_policy_import_errors_total)
      - name: Number of endpoints labeled by policy enforcement status
        query: sum(cilium_policy_endpoint_enforcement_status)
      - name: Time between a policy change and it being fully deployed into the datapath
          - Perc50
        query: histogram_quantile(0.50, sum(cilium_policy_implementation_delay_bucket)
          by (le))
      - name: Time between a policy change and it being fully deployed into the datapath
          - Perc99
        query: histogram_quantile(0.99, sum(cilium_policy_implementation_delay_bucket)
          by (le))
      - name: Latency of policy update trigger - Perc50
        query: histogram_quantile(0.50, sum(cilium_triggers_policy_update_call_duration_seconds_bucket{type="latency"})
          by (le))
      - name: Latency of policy update trigger - Perc99
        query: histogram_quantile(0.99, sum(cilium_triggers_policy_update_call_duration_seconds_bucket{type="latency"})
          by (le))
      - name: Failed endpoint regenerations
        query: sum(cilium_endpoint_regenerations_total{outcome="fail"})
      unit: s
    identifier: NetworkPolicyMetrics
    instances: []
  module:
    path: ""
    params: {}
  name: starting network policy metrics
- phases: []
  measurements:
  - method: NetworkPolicyEnforcement
    params:
      action: setup
      baseline: false
      targetLabelKey: net-pol-test
      targetLabelValue: enforcement-latency
    identifier: NetworkPolicyEnforcement
    instances: []
  module:
    path: ""
    params: {}
  name: Setup network policy enforcement latency measurement
- phases: []
  measurements:
  - method: NetworkPolicyEnforcement
    params:
      action: run
      expectedTargets: 100
      podCreation: true
      policyLoadCount: 1000
      policyLoadQPS: 10
      policyLoadTargetBaseName: small-deployment
      targetPort: 80
    identifier: NetworkPolicyEnforcement
    instances: []
  module:
    path: ""
    params: {}
  name: Run pod creation network policy enforcement latency measurement (podCreation=true)
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: Sequence
    objectbundle:
    - basename: big-service
      objecttemplatepath: service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 12
    tuningset: Sequence
    objectbundle:
    - basename: medium-service
      objecttemplatepath: service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 149
    tuningset: Sequence
    objectbundle:
    - basename: small-service
      objecttemplatepath: service.yaml
      templatefillmap:
        EnableNetworkPolicyEnforcementLatencyTest: true
        TargetLabelKey: net-pol-test
        TargetLabelValue: enforcement-latency
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: Creating k8s services
- phases:
  - namespacerange: null
    replicaspernamespace: 1
    tuningset: Sequence
    objectbundle:
    - basename: daemonset-priorityclass
      objecttemplatepath: daemonset-priorityclass.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: Creating PriorityClass for DaemonSets
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 2
    tuningset: default
    objectbundle:
    - basename: big-deployment
      objecttemplatepath: configmap.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: big-deployment
      objecttemplatepath: secret.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 23
    tuningset: default
    objectbundle:
    - basename: medium-deployment
      objecttemplatepath: configmap.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: medium-deployment
      objecttemplatepath: secret.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 298
    tuningset: default
    objectbundle:
    - basename: small-deployment
      objecttemplatepath: configmap.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: small-deployment
      objecttemplatepath: secret.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: create objects configmaps and secrets
- phases: []
  measurements:
  - method: WaitForControlledPodsRunning
    params:
      action: start
      checkIfPodsAreUpdated: true
      labelSelector: group = load
      operationTimeout: 15m
    identifier: ""
    instances:
    - identifier: WaitForRunningDeployments
      params:
        apiVersion: apps/v1
        kind: Deployment
    - identifier: WaitForRunningStatefulSets
      params:
        apiVersion: apps/v1
        kind: StatefulSet
    - identifier: WaitForRunningDaemonSets
      params:
        apiVersion: apps/v1
        kind: DaemonSet
    - identifier: WaitForRunningJobs
      params:
        apiVersion: batch/v1
        kind: Job
  module:
    path: ""
    params: {}
  name: Starting measurement for 'create objects'
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 2
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: big-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        ReplicasMax: 250
        ReplicasMin: 250
        SvcName: big-service
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 23
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: medium-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        ReplicasMax: 30
        ReplicasMin: 30
        SvcName: medium-service
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 298
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: small-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        EnableNetworkPolicyEnforcementLatencyTest: true
        ReplicasMax: 5
        ReplicasMin: 5
        SvcName: small-service
        TargetLabelKey: net-pol-test
        TargetLabelValue: enforcement-latency
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: small-statefulset
      objecttemplatepath: statefulset_service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: small-statefulset
      objecttemplatepath: statefulset.yaml
      templatefillmap:
        ReplicasMax: 5
        ReplicasMin: 5
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: medium-statefulset
      objecttemplatepath: statefulset_service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: medium-statefulset
      objecttemplatepath: statefulset.yaml
      templatefillmap:
        ReplicasMax: 30
        ReplicasMin: 30
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: small-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 15
        ReplicasMax: 5
        ReplicasMin: 5
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: medium-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 90
        ReplicasMax: 30
        ReplicasMin: 30
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedSaturationTimeLimited
    objectbundle:
    - basename: big-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 750
        ReplicasMax: 250
        ReplicasMin: 250
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: create objects
- phases: []
  measurements:
  - method: WaitForControlledPodsRunning
    params:
      action: gather
    identifier: ""
    instances:
    - identifier: WaitForRunningDeployments
      params: {}
    - identifier: WaitForRunningStatefulSets
      params: {}
    - identifier: WaitForRunningDaemonSets
      params: {}
    - identifier: WaitForRunningJobs
      params: {}
  module:
    path: ""
    params: {}
  name: Waiting for 'create objects' to be completed
- phases: []
  measurements:
  - method: GenericPrometheusQuery
    params:
      action: gather
      metricName: Network Policy Enforcement Latency
      metricVersion: v1
      queries:
      - name: PolicyCreation - TargetCount
        query: sum(policy_enforcement_latency_policy_creation_seconds_count)#[%v]
      - name: PolicyCreation - Bucket 5s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="5"})#[%v]
      - name: PolicyCreation - Bucket 10s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="10"})#[%v]
      - name: PolicyCreation - Bucket 60s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="60"})#[%v]
      - name: PolicyCreation - Perc50
        query: histogram_quantile(0.5, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc90
        query: histogram_quantile(0.9, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc95
        query: histogram_quantile(0.95, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc99
        query: histogram_quantile(0.99, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PodCreation - TargetCount
        query: sum(policy_enforcement_latency_pod_creation_seconds_count)
      - name: PodCreation - Bucket 1s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="1"})
      - name: PodCreation - Bucket 5s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="5"})
      - name: PodCreation - Bucket 10s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="10"})
      - name: PodCreation - Bucket 60s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="60"})
      - name: PodCreation - Bucket 600s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="600"})
      - name: PodCreation - Perc50
        query: histogram_quantile(0.5, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc90
        query: histogram_quantile(0.9, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc95
        query: histogram_quantile(0.95, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc99
        query: histogram_quantile(0.99, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - TargetCount
        query: sum(pod_ip_address_assigned_latency_seconds_count)#[%v:]
      - name: PodIpAssignedLatency - Perc50
        query: histogram_quantile(0.50, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc90
        query: histogram_quantile(0.90, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc95
        query: histogram_quantile(0.95, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc99
        query: histogram_quantile(0.99, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      unit: s
    identifier: NetworkPolicyEnforcementLatency
    instances: []
  - method: GenericPrometheusQuery
    params:
      action: gather
      metricName: Network Policy Performance
      metricVersion: v1
      queries:
      - name: Number of policies currently loaded
        query: avg(cilium_policy)
      - name: Policy regeneration time - Perc50
        query: histogram_quantile(0.50, sum(cilium_policy_regeneration_time_stats_seconds_bucket{scope="total"})
          by (le))
      - name: Policy regeneration time - Perc99
        query: histogram_quantile(0.99, sum(cilium_policy_regeneration_time_stats_seconds_bucket{scope="total"})
          by (le))
      - name: Number of times a policy import has failed
        query: sum(cilium_policy_import_errors_total)
      - name: Number of endpoints labeled by policy enforcement status
        query: sum(cilium_policy_endpoint_enforcement_status)
      - name: Time between a policy change and it being fully deployed into the datapath
          - Perc50
        query: histogram_quantile(0.50, sum(cilium_policy_implementation_delay_bucket)
          by (le))
      - name: Time between a policy change and it being fully deployed into the datapath
          - Perc99
        query: histogram_quantile(0.99, sum(cilium_policy_implementation_delay_bucket)
          by (le))
      - name: Latency of policy update trigger - Perc50
        query: histogram_quantile(0.50, sum(cilium_triggers_policy_update_call_duration_seconds_bucket{type="latency"})
          by (le))
      - name: Latency of policy update trigger - Perc99
        query: histogram_quantile(0.99, sum(cilium_triggers_policy_update_call_duration_seconds_bucket{type="latency"})
          by (le))
      - name: Failed endpoint regenerations
        query: sum(cilium_endpoint_regenerations_total{outcome="fail"})
      unit: s
    identifier: NetworkPolicyMetrics
    instances: []
  module:
    path: ""
    params: {}
  name: gathering network policy metrics
- phases: []
  measurements:
  - method: NetworkPolicyEnforcement
    params:
      action: complete
      podCreation: true
    identifier: NetworkPolicyEnforcement
    instances: []
  module:
    path: ""
    params: {}
  name: Complete pod creation network policy enforcement latency measurement (podCreation=true)
- phases: []
  measurements:
  - method: NetworkPolicyEnforcement
    params:
      action: run
      expectedTargets: 100
      podCreation: false
      policyLoadCount: 1000
      policyLoadQPS: 10
      policyLoadTargetBaseName: small-deployment
      targetPort: 80
    identifier: NetworkPolicyEnforcement
    instances: []
  module:
    path: ""
    params: {}
  name: Run pod creation network policy enforcement latency measurement (podCreation=false)
- phases: []
  measurements:
  - method: WaitForControlledPodsRunning
    params:
      action: start
      checkIfPodsAreUpdated: true
      labelSelector: group = load
      operationTimeout: 15m
    identifier: ""
    instances:
    - identifier: WaitForRunningDeployments
      params:
        apiVersion: apps/v1
        kind: Deployment
    - identifier: WaitForRunningStatefulSets
      params:
        apiVersion: apps/v1
        kind: StatefulSet
    - identifier: WaitForRunningDaemonSets
      params:
        apiVersion: apps/v1
        kind: DaemonSet
    - identifier: WaitForRunningJobs
      params:
        apiVersion: batch/v1
        kind: Job
  module:
    path: ""
    params: {}
  name: Starting measurement for 'scale and update objects'
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 2
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: big-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        ReplicasMax: 375
        ReplicasMin: 125
        SvcName: big-service
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 23
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: medium-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        ReplicasMax: 45
        ReplicasMin: 15
        SvcName: medium-service
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 298
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: small-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        EnableNetworkPolicyEnforcementLatencyTest: true
        ReplicasMax: 7
        ReplicasMin: 2
        SvcName: small-service
        TargetLabelKey: net-pol-test
        TargetLabelValue: enforcement-latency
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: small-statefulset
      objecttemplatepath: statefulset_service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: small-statefulset
      objecttemplatepath: statefulset.yaml
      templatefillmap:
        ReplicasMax: 7
        ReplicasMin: 2
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: medium-statefulset
      objecttemplatepath: statefulset_service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: medium-statefulset
      objecttemplatepath: statefulset.yaml
      templatefillmap:
        ReplicasMax: 45
        ReplicasMin: 15
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: small-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 15
        ReplicasMax: 7
        ReplicasMin: 2
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 1
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: medium-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 90
        ReplicasMax: 45
        ReplicasMin: 15
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedScalingTimeLimited
    objectbundle:
    - basename: big-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 750
        ReplicasMax: 375
        ReplicasMin: 125
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: scale and update objects
- phases: []
  measurements:
  - method: WaitForControlledPodsRunning
    params:
      action: gather
    identifier: ""
    instances:
    - identifier: WaitForRunningDeployments
      params: {}
    - identifier: WaitForRunningStatefulSets
      params: {}
    - identifier: WaitForRunningDaemonSets
      params: {}
    - identifier: WaitForRunningJobs
      params: {}
  module:
    path: ""
    params: {}
  name: Waiting for 'scale and update objects' to be completed
- phases: []
  measurements:
  - method: WaitForControlledPodsRunning
    params:
      action: start
      checkIfPodsAreUpdated: true
      labelSelector: group = load
      operationTimeout: 15m
    identifier: ""
    instances:
    - identifier: WaitForRunningDeployments
      params:
        apiVersion: apps/v1
        kind: Deployment
    - identifier: WaitForRunningStatefulSets
      params:
        apiVersion: apps/v1
        kind: StatefulSet
    - identifier: WaitForRunningDaemonSets
      params:
        apiVersion: apps/v1
        kind: DaemonSet
    - identifier: WaitForRunningJobs
      params:
        apiVersion: batch/v1
        kind: Job
  module:
    path: ""
    params: {}
  name: Starting measurement for 'delete objects'
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: big-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        ReplicasMax: 250
        ReplicasMin: 250
        SvcName: big-service
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: medium-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        ReplicasMax: 30
        ReplicasMin: 30
        SvcName: medium-service
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: small-deployment
      objecttemplatepath: deployment.yaml
      templatefillmap:
        EnableDNSTests: false
        EnableNetworkPolicyEnforcementLatencyTest: true
        ReplicasMax: 5
        ReplicasMin: 5
        SvcName: small-service
        TargetLabelKey: net-pol-test
        TargetLabelValue: enforcement-latency
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: small-statefulset
      objecttemplatepath: statefulset_service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: small-statefulset
      objecttemplatepath: statefulset.yaml
      templatefillmap:
        ReplicasMax: 5
        ReplicasMin: 5
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: medium-statefulset
      objecttemplatepath: statefulset_service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: medium-statefulset
      objecttemplatepath: statefulset.yaml
      templatefillmap:
        ReplicasMax: 30
        ReplicasMin: 30
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: small-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 15
        ReplicasMax: 5
        ReplicasMin: 5
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: medium-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 90
        ReplicasMax: 30
        ReplicasMin: 30
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: big-job
      objecttemplatepath: job.yaml
      templatefillmap:
        Completions: 750
        ReplicasMax: 250
        ReplicasMin: 250
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: pv-small-statefulset-0
      objecttemplatepath: pvc.yaml
      templatefillmap: {}
      listunknownobjectoptions:
        labelselector:
          matchlabels:
            name: small-statefulset-0
          matchexpressions: []
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: RandomizedDeletionTimeLimited
    objectbundle:
    - basename: pv-medium-statefulset-0
      objecttemplatepath: pvc.yaml
      templatefillmap: {}
      listunknownobjectoptions:
        labelselector:
          matchlabels:
            name: medium-statefulset-0
          matchexpressions: []
  measurements: []
  module:
    path: ""
    params: {}
  name: delete objects
- phases: []
  measurements:
  - method: WaitForControlledPodsRunning
    params:
      action: gather
    identifier: ""
    instances:
    - identifier: WaitForRunningDeployments
      params: {}
    - identifier: WaitForRunningStatefulSets
      params: {}
    - identifier: WaitForRunningDaemonSets
      params: {}
    - identifier: WaitForRunningJobs
      params: {}
  - method: WaitForBoundPVCs
    params:
      desiredPVCCount: 0
      labelSelector: group = load
      timeout: 15m
    identifier: WaitForPVCsToBeDeleted
    instances: []
  module:
    path: ""
    params: {}
  name: Waiting for 'delete objects' to be completed
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: default
    objectbundle:
    - basename: big-deployment
      objecttemplatepath: configmap.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: big-deployment
      objecttemplatepath: secret.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: default
    objectbundle:
    - basename: medium-deployment
      objecttemplatepath: configmap.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: medium-deployment
      objecttemplatepath: secret.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: default
    objectbundle:
    - basename: small-deployment
      objecttemplatepath: configmap.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
    - basename: small-deployment
      objecttemplatepath: secret.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: delete objects configmaps and secrets
- phases:
  - namespacerange: null
    replicaspernamespace: 0
    tuningset: Sequence
    objectbundle:
    - basename: daemonset-priorityclass
      objecttemplatepath: daemonset-priorityclass.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: Deleting PriorityClass for DaemonSets
- phases:
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: Sequence
    objectbundle:
    - basename: big-service
      objecttemplatepath: service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: Sequence
    objectbundle:
    - basename: medium-service
      objecttemplatepath: service.yaml
      templatefillmap: {}
      listunknownobjectoptions: null
  - namespacerange:
      min: 1
      max: 1
      basename: null
    replicaspernamespace: 0
    tuningset: Sequence
    objectbundle:
    - basename: small-service
      objecttemplatepath: service.yaml
      templatefillmap:
        EnableNetworkPolicyEnforcementLatencyTest: true
        TargetLabelKey: net-pol-test
        TargetLabelValue: enforcement-latency
      listunknownobjectoptions: null
  measurements: []
  module:
    path: ""
    params: {}
  name: Deleting k8s services
- phases: []
  measurements:
  - method: APIResponsivenessPrometheus
    params:
      action: gather
      allowedSlowCalls: 0
      customThresholds: ""
      enableViolations: false
    identifier: APIResponsivenessPrometheus
    instances: []
  - method: APIResponsivenessPrometheus
    params:
      action: gather
      allowedSlowCalls: 0
      customThresholds: ""
      enableViolations: true
      summaryName: APIResponsivenessPrometheus_simple
      useSimpleLatencyQuery: true
    identifier: APIResponsivenessPrometheusSimple
    instances: []
  - method: PodStartupLatency
    params:
      action: gather
      labelSelector: group = load
      threshold: 1h
    identifier: CreatePhasePodStartupLatency
    instances: []
  - method: NetworkProgrammingLatency
    params:
      action: gather
    identifier: NetworkProgrammingLatency
    instances: []
  - method: TestMetrics
    params:
      action: gather
      clusterOOMsIgnoredProcesses: ""
      clusterOOMsTrackerEnabled: false
      enableRestartCountCheck: false
      restartCountThresholdOverrides: ""
      systemPodMetricsEnabled: false
    identifier: TestMetrics
    instances: []
  module:
    path: ""
    params: {}
  name: gathering measurements
- phases: []
  measurements:
  - method: GenericPrometheusQuery
    params:
      action: gather
      metricName: Network Policy Enforcement Latency
      metricVersion: v1
      queries:
      - name: PolicyCreation - TargetCount
        query: sum(policy_enforcement_latency_policy_creation_seconds_count)#[%v]
      - name: PolicyCreation - Bucket 5s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="5"})#[%v]
      - name: PolicyCreation - Bucket 10s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="10"})#[%v]
      - name: PolicyCreation - Bucket 60s
        query: sum(policy_enforcement_latency_policy_creation_seconds_bucket{le="60"})#[%v]
      - name: PolicyCreation - Perc50
        query: histogram_quantile(0.5, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc90
        query: histogram_quantile(0.9, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc95
        query: histogram_quantile(0.95, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PolicyCreation - Perc99
        query: histogram_quantile(0.99, sum(policy_enforcement_latency_policy_creation_seconds_bucket)
          by (le))#[%v]
      - name: PodCreation - TargetCount
        query: sum(policy_enforcement_latency_pod_creation_seconds_count)
      - name: PodCreation - Bucket 1s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="1"})
      - name: PodCreation - Bucket 5s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="5"})
      - name: PodCreation - Bucket 10s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="10"})
      - name: PodCreation - Bucket 60s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="60"})
      - name: PodCreation - Bucket 600s
        query: sum(policy_enforcement_latency_pod_creation_seconds_bucket{le="600"})
      - name: PodCreation - Perc50
        query: histogram_quantile(0.5, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc90
        query: histogram_quantile(0.9, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc95
        query: histogram_quantile(0.95, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodCreation - Perc99
        query: histogram_quantile(0.99, sum(rate(policy_enforcement_latency_pod_creation_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - TargetCount
        query: sum(pod_ip_address_assigned_latency_seconds_count)#[%v:]
      - name: PodIpAssignedLatency - Perc50
        query: histogram_quantile(0.50, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc90
        query: histogram_quantile(0.90, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc95
        query: histogram_quantile(0.95, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      - name: PodIpAssignedLatency - Perc99
        query: histogram_quantile(0.99, sum(rate(pod_ip_address_assigned_latency_seconds_bucket[%v]))
          by (le))
      unit: s
    identifier: NetworkPolicyEnforcementLatency
    instances: []
  - method: GenericPrometheusQuery
    params:
      action: gather
      metricName: Network Policy Performance
      metricVersion: v1
      queries:
      - name: Number of policies currently loaded
        query: avg(cilium_policy)
      - name: Policy regeneration time - Perc50
        query: histogram_quantile(0.50, sum(cilium_policy_regeneration_time_stats_seconds_bucket{scope="total"})
          by (le))
      - name: Policy regeneration time - Perc99
        query: histogram_quantile(0.99, sum(cilium_policy_regeneration_time_stats_seconds_bucket{scope="total"})
          by (le))
      - name: Number of times a policy import has failed
        query: sum(cilium_policy_import_errors_total)
      - name: Number of endpoints labeled by policy enforcement status
        query: sum(cilium_policy_endpoint_enforcement_status)
      - name: Time between a policy change and it being fully deployed into the datapath
          - Perc50
        query: histogram_quantile(0.50, sum(cilium_policy_implementation_delay_bucket)
          by (le))
      - name: Time between a policy change and it being fully deployed into the datapath
          - Perc99
        query: histogram_quantile(0.99, sum(cilium_policy_implementation_delay_bucket)
          by (le))
      - name: Latency of policy update trigger - Perc50
        query: histogram_quantile(0.50, sum(cilium_triggers_policy_update_call_duration_seconds_bucket{type="latency"})
          by (le))
      - name: Latency of policy update trigger - Perc99
        query: histogram_quantile(0.99, sum(cilium_triggers_policy_update_call_duration_seconds_bucket{type="latency"})
          by (le))
      - name: Failed endpoint regenerations
        query: sum(cilium_endpoint_regenerations_total{outcome="fail"})
      unit: s
    identifier: NetworkPolicyMetrics
    instances: []
  module:
    path: ""
    params: {}
  name: gathering network policy metrics
tuningsets:
- name: Sequence
  initialdelay: 0
  qpsload: null
  randomizedload: null
  steppedload: null
  timelimitedload: null
  randomizedtimelimitedload: null
  parallelismlimitedload:
    parallelismlimit: 1
  globalqpsload: null
- name: Uniform5qps
  initialdelay: 0
  qpsload:
    qps: 5
  randomizedload: null
  steppedload: null
  timelimitedload: null
  randomizedtimelimitedload: null
  parallelismlimitedload: null
  globalqpsload: null
- name: default
  initialdelay: 0
  qpsload: null
  randomizedload: null
  steppedload: null
  timelimitedload: null
  randomizedtimelimitedload: null
  parallelismlimitedload: null
  globalqpsload:
    qps: 10
    burst: 1
- name: RandomizedSaturationTimeLimited
  initialdelay: 0
  qpsload: null
  randomizedload: null
  steppedload: null
  timelimitedload: null
  randomizedtimelimitedload:
    timelimit: 300000000000
  parallelismlimitedload: null
  globalqpsload: null
- name: RandomizedScalingTimeLimited
  initialdelay: 0
  qpsload: null
  randomizedload: null
  steppedload: null
  timelimitedload: null
  randomizedtimelimitedload:
    timelimit: 75000000000
  parallelismlimitedload: null
  globalqpsload: null
- name: RandomizedDeletionTimeLimited
  initialdelay: 0
  qpsload: null
  randomizedload: null
  steppedload: null
  timelimitedload: null
  randomizedtimelimitedload:
    timelimit: 300000000000
  parallelismlimitedload: null
  globalqpsload: null
chaosmonkey:
  nodefailure: null
  excludednodes: {}
